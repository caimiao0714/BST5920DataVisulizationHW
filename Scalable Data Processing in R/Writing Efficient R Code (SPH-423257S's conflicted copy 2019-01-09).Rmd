---
title: "Writing Efficient R Code"
author: "Miao Cai"
date: "1/9/2019"
output:
  html_document:
    theme: yeti
    toc: true
    toc_float: true
    number_sections: true
    df_print: paged
    code_folding: show
  pdf_document:
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

```{r RandC, fig.cap="Comparing R and C"}
knitr::include_graphics("RandC.png")
```

> Premature optimization is the root of all evil
> -- by Donald Knuth

You should only optimize your code when necessary. 

## Keep your R version updated.

One of the relatively easy optimizations available is to use an up-to-date version of R. In general, R is very conservative, so upgrading doesn't break existing code. However, a new version will often provide free speed boosts for key functions. The `version` command returns a list that contains (among other things) the major and minor version of R currently being used.

```{r version}
# Print the R version details using version
version

# Assign the variable major to the major component
(major <- version$major)

# Assign the variable minor to the minor component
(minor <- version$minor)
```

## Benchmark

Timing with `system.time()`

- *user time*: the CPU time charged for the execution of user instructions
- *system time*: the CPU time charged for execution by the system on behalf of the calling process.
- *elapsed time*: approximately the sum of user and system time, which is ususally the time we care about.

```{Benchmark}
library(microbenchmark)
set.seed(666)
n = 1e8
microbenchmark(
  colon(n),
  seq.default(n),
  seq_by(n)
)
```

`readRDS("data.rds)` is almost 10 times faster than `read.csv("data.csv)`

## How good is your machine

```{r eval = FALSE}
library("benchmarkme")
res = benchmark_std(runs = 3)
plot(res)
upload_results(res)


```

- SALUS windows computer: You are ranked 79 out of 82 machines.
- Macbook Pro 2018: You are ranked 63 out of 82 machines

For many problems your time is the expensive part. If having a faster computer makes you more productive, it can be cost effective to buy one. However, before you splash out on new toys for yourself, your boss/partner may want to see some numbers to justify the expense. Measuring the performance of your computer is called benchmarking, and you can do that with the `benchmarkme` package.

```{r}
(ram <- get_ram())
(cpu <- get_cpu())
```

The benchmarkme package allows you to run a set of standardized benchmarks and compare your results to other users. One set of benchmarks tests is reading and writing speeds.

The function call

```{r}
res = benchmark_io(runs = 1, size = 5)
```

records the length of time it takes to read and write a 50 MB file.